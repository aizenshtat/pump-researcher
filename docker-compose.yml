version: '3.8'

services:
  pump-researcher:
    build: .
    container_name: pump-researcher
    env_file:
      - .env
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      # Pump detection parameters
      - PUMP_THRESHOLD_PCT=${PUMP_THRESHOLD_PCT:-5.0}
      - PUMP_TIME_WINDOW_MINUTES=${PUMP_TIME_WINDOW_MINUTES:-60}
      # Reddit
      - REDDIT_CLIENT_ID=${REDDIT_CLIENT_ID}
      - REDDIT_CLIENT_SECRET=${REDDIT_CLIENT_SECRET}
      # Telegram
      - TELEGRAM_API_ID=${TELEGRAM_API_ID}
      - TELEGRAM_API_HASH=${TELEGRAM_API_HASH}
      - TELEGRAM_PHONE_NUMBER=${TELEGRAM_PHONE_NUMBER}
      - TELEGRAM_CHAT_ID=${TELEGRAM_CHAT_ID}
      # Twitter
      - TWITTER_USERNAME=${TWITTER_USERNAME}
      - TWITTER_PASSWORD=${TWITTER_PASSWORD}
      - TWITTER_EMAIL=${TWITTER_EMAIL}
      # Discord
      - DISCORD_EMAIL=${DISCORD_EMAIL}
      - DISCORD_PASSWORD=${DISCORD_PASSWORD}
      - DISCORD_HEADLESS=true
      # CoinMarketCap
      - COINMARKETCAP_API_KEY=${COINMARKETCAP_API_KEY}
      - COINMARKETCAP_SUBSCRIPTION_LEVEL=${COINMARKETCAP_SUBSCRIPTION_LEVEL:-Basic}
      # Binance
      - BINANCE_API_KEY=${BINANCE_API_KEY}
      - BINANCE_API_SECRET=${BINANCE_API_SECRET}
      - BINANCE_TESTNET=${BINANCE_TESTNET:-false}
      # Grok/xAI
      - XAI_API_KEY=${XAI_API_KEY}
    volumes:
      - ./data:/app/data
      - ./.claude:/app/.claude
    restart: "no"

  # Web interface for viewing results
  web:
    build: .
    container_name: pump-web
    ports:
      - "5000:5000"
    volumes:
      - ./data:/app/data
    environment:
      - FLASK_ENV=production
    entrypoint: ["python3"]
    command: ["src/web/app.py"]
    restart: unless-stopped

volumes:
  data:
